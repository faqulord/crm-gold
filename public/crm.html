<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Enterprise Portal</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root { --bg-dark: #09090b; --sidebar-bg: #121214; --card-bg: #18181b; --border: #27272a; --primary: #3b82f6; --text-main: #f4f4f5; --text-muted: #a1a1aa; --success: #10b981; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Inter', sans-serif; background: var(--bg-dark); color: var(--text-main); height: 100vh; overflow: hidden; }

        /* LOGIN */
        #login-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; display: flex; background: var(--bg-dark); transition: 0.5s; }
        .login-brand-side { flex: 1; background: linear-gradient(135deg, #1e3a8a 0%, #000000 100%); display: flex; flex-direction: column; justify-content: center; padding: 60px; position: relative; }
        .login-form-side { width: 500px; display: flex; align-items: center; justify-content: center; background: var(--bg-dark); border-left: 1px solid var(--border); }
        .login-box { width: 100%; max-width: 360px; padding: 20px; }
        .inp-field { width: 100%; background: var(--card-bg); border: 1px solid var(--border); color: white; padding: 12px; border-radius: 8px; margin-bottom: 20px; outline: none; }
        .btn-login { width: 100%; background: var(--primary); color: white; border: none; padding: 14px; border-radius: 8px; font-weight: 600; cursor: pointer; }
        
        /* APP */
        #app-wrap { display: none; display: flex; height: 100vh; }
        .sidebar { width: 280px; background: var(--sidebar-bg); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; }
        .nav-item { padding: 12px; color: var(--text-muted); border-radius: 8px; margin-bottom: 4px; cursor: pointer; display: flex; gap: 10px; align-items: center; }
        .nav-item.active { background: rgba(59,130,246,0.1); color: var(--primary); }
        .main-area { flex: 1; display: flex; flex-direction: column; background: var(--bg-dark); }
        .top-header { height: 70px; border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 32px; }
        .content-scroll { flex: 1; overflow-y: auto; padding: 32px; }
        
        /* CARDS & TABLE */
        .kpi-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 24px; margin-bottom: 32px; }
        .kpi-card { background: var(--card-bg); border: 1px solid var(--border); padding: 24px; border-radius: 12px; }
        .kpi-value { font-size: 2rem; font-weight: 700; margin-top: 10px; }
        
        .data-panel { background: var(--card-bg); border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 16px 24px; color: var(--text-muted); font-size: 0.75rem; border-bottom: 1px solid var(--border); }
        td { padding: 16px 24px; border-bottom: 1px solid var(--border); }
        
        .badge { padding: 4px 10px; border-radius: 20px; font-size: 0.75rem; background: rgba(59,130,246,0.15); color: #60a5fa; display: inline-block; }

        /* MOBIL */
        @media (max-width: 1024px) { 
            .login-brand-side { display: none; } 
            .login-form-side { width: 100%; } 
            .sidebar { display: none; }
            .kpi-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>

    <div id="login-wrap">
        <div class="login-brand-side">
            <h1 style="color: white; font-size: 3rem; font-weight: 800;">FaquDeveloper</h1>
            <p style="color: #aaa; font-size: 1.2rem;">Enterprise Resource Planning v2.0</p>
        </div>
        <div class="login-form-side">
            <div class="login-box">
                <h2 style="color: white; margin-bottom: 30px;">Bejelentkezés</h2>
                <form onsubmit="doLogin(event)">
                    <label style="color: #888; font-size: 0.8rem;">FELHASZNÁLÓNÉV</label>
                    <input type="text" class="inp-field" value="admin">
                    <label style="color: #888; font-size: 0.8rem;">JELSZÓ</label>
                    <input type="password" class="inp-field" value="pass">
                    <button type="submit" class="btn-login">BELÉPÉS</button>
                </form>
            </div>
        </div>
    </div>

    <div id="app-wrap">
        <div class="sidebar">
            <h3 style="color: white; margin-bottom: 30px;">FaquDev</h3>
            <div class="nav-item active"><i class="bi bi-grid"></i> Áttekintés</div>
            <div class="nav-item"><i class="bi bi-people"></i> <span id="menu_main">Ügyfelek</span></div>
            <div class="nav-item" style="color: #ef4444; margin-top: auto;" onclick="location.reload()">Kilépés</div>
        </div>
        <div class="main-area">
            <div class="top-header">
                <div style="color: #888;">Dashboard / Áttekintés</div>
                <div style="color: white;">Admin</div>
            </div>
            <div class="content-scroll">
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div style="color: #888; font-size: 0.8rem;">HAVI BEVÉTEL</div>
                        <div class="kpi-value" id="val_rev">0 Ft</div>
                    </div>
                    <div class="kpi-card">
                        <div style="color: #888; font-size: 0.8rem;" id="lbl_kpi">AKTÍV ÜGYEK</div>
                        <div class="kpi-value" id="val_count">0</div>
                    </div>
                </div>

                <div class="data-panel">
                    <div style="padding: 20px; border-bottom: 1px solid #27272a; font-weight: bold;">Legutóbbi Tételek</div>
                    <div style="overflow-x: auto;">
                        <table>
                            <thead>
                                <tr>
                                    <th id="th_1">Név</th>
                                    <th id="th_2">Részletek</th>
                                    <th>Státusz</th>
                                    <th>Összeg</th>
                                </tr>
                            </thead>
                            <tbody id="table_body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let config = {};
        
        // INIT
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                const res = await fetch('/api/config');
                config = await res.json();
                setupIndustry(config.industry || 'general');
            } catch(e) { console.log('Demo mode'); }
        });

        function setupIndustry(ind) {
            const dict = {
                restaurant: { menu: "Rendelések", kpi: "NYITOTT RENDELÉS", th1: "Asztal", th2: "Tétel" },
                mechanic: { menu: "Munkalapok", kpi: "AUTÓK BENT", th1: "Rendszám", th2: "Hiba" },
                doctor: { menu: "Páciensek", kpi: "MAI KEZELÉSEK", th1: "Páciens", th2: "Kezelés" },
                general: { menu: "Ügyfelek", kpi: "AKTÍV ÜGYFELEK", th1: "Név", th2: "Leírás" }
            };
            const t = dict[ind] || dict.general;
            document.getElementById('menu_main').innerText = t.menu;
            document.getElementById('lbl_kpi').innerText = t.kpi;
            document.getElementById('th_1').innerText = t.th1;
            document.getElementById('th_2').innerText = t.th2;
        }

        function doLogin(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.innerText = 'Betöltés...';
            setTimeout(() => {
                document.getElementById('login-wrap').style.opacity = 0;
                setTimeout(() => {
                    document.getElementById('login-wrap').style.display = 'none';
                    document.getElementById('app-wrap').style.display = 'flex';
                    loadData();
                }, 500);
            }, 800);
        }

        async function loadData() {
            const res = await fetch('/api/clients');
            const clients = await res.json();
            const tbody = document.getElementById('table_body');
            tbody.innerHTML = '';
            let total = 0, count = 0;

            clients.forEach(c => {
                total += (c.amount || 0);
                if(c.status === 'active') count++;
                tbody.innerHTML += `
                    <tr>
                        <td style="font-weight:bold; color:white;">${c.name}</td>
                        <td style="color:#aaa;">${c.details}</td>
                        <td><div class="badge">Folyamatban</div></td>
                        <td>${c.amount} Ft</td>
                    </tr>`;
            });
            document.getElementById('val_rev').innerText = total + " Ft";
            document.getElementById('val_count').innerText = count;
        }
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <title>Enterprise Core v2</title>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@200;400;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root { 
            --bg: #050505; 
            --sidebar: #0a0a0a; 
            --card: #0f0f0f; 
            --primary: #ff6600; 
            --primary-glow: rgba(255, 102, 0, 0.15);
            --text: #ffffff; 
            --text-dim: #777; 
            --border: #1a1a1a; 
        }
        * { box-sizing: border-box; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { margin: 0; font-family: 'Outfit', sans-serif; background: var(--bg); color: var(--text); overflow-x: hidden; font-weight: 400; }

        /* OLDALSÁV (LUXURY) */
        aside { width: 260px; background: var(--sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 40px 25px; position: fixed; height: 100vh; z-index: 1000; }
        .logo { font-size: 1.1rem; font-weight: 700; color: var(--primary); letter-spacing: 4px; margin-bottom: 50px; text-transform: uppercase; }
        .nav-link { padding: 15px 0; color: var(--text-dim); text-decoration: none; display: flex; align-items: center; gap: 15px; margin-bottom: 10px; cursor: pointer; border-bottom: 1px solid transparent; font-size: 0.85rem; letter-spacing: 1px; }
        .nav-link:hover { color: var(--primary); }
        .nav-link.active { color: var(--primary); border-bottom: 1px solid var(--primary); }
        .nav-link i { font-size: 1.1rem; }

        main { flex: 1; margin-left: 260px; padding: 50px; max-width: 1400px; }

        /* STATISZTIKA */
        .header-row { margin-bottom: 50px; }
        .header-row h1 { font-size: 2.5rem; font-weight: 200; margin: 0; letter-spacing: -1px; }
        .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 25px; margin-bottom: 50px; }
        .card { background: var(--card); padding: 35px; border-radius: 4px; border: 1px solid var(--border); position: relative; overflow: hidden; }
        .card::before { content: ""; position: absolute; top: 0; left: 0; width: 2px; height: 0; background: var(--primary); transition: 0.5s; }
        .card:hover::before { height: 100%; }
        .card small { color: var(--text-dim); font-size: 0.7rem; letter-spacing: 2px; text-transform: uppercase; }
        .card .val { font-size: 2.4rem; font-weight: 600; margin-top: 15px; display: block; letter-spacing: -1px; }

        /* TÁBLÁZAT */
        .table-wrap { background: var(--card); border: 1px solid var(--border); border-radius: 4px; }
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 20px; font-size: 0.7rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid var(--border); }
        td { padding: 20px; border-bottom: 1px solid var(--border); font-size: 0.9rem; color: #ccc; }
        tr:hover td { color: #fff; background: rgba(255,255,255,0.01); }

        /* MODAL & BUTTONS */
        .btn { padding: 12px 30px; border-radius: 2px; font-weight: 600; cursor: pointer; border: none; font-size: 0.75rem; letter-spacing: 2px; text-transform: uppercase; }
        .btn-primary { background: var(--primary); color: #000; }
        .btn-outline { background: transparent; border: 1px solid var(--border); color: #fff; }
        .btn-outline:hover { border-color: var(--primary); color: var(--primary); }

        #login-screen { position: fixed; inset: 0; background: var(--bg); z-index: 10001; display: flex; justify-content: center; align-items: center; }
        .login-card { text-align: center; width: 100%; max-width: 320px; }
        input { width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--border); padding: 15px 0; color: #fff; margin-bottom: 30px; font-family: inherit; font-size: 1.1rem; text-align: center; }
        input:focus { outline: none; border-bottom-color: var(--primary); }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 10002; display: none; align-items: center; justify-content: center; padding: 20px; }
        .modal-content { background: var(--sidebar); padding: 50px; width: 100%; max-width: 450px; border: 1px solid var(--border); }

        @media (max-width: 1024px) { aside { display: none; } main { margin-left: 0; padding: 30px; } }
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-card">
            <h1 id="l_comp" style="font-weight: 200; letter-spacing: 5px; margin-bottom: 50px;">ENTERPRISE</h1>
            <input type="password" id="pass" placeholder="SECURITY CODE">
            <button class="btn btn-primary" style="width: 100%;" onclick="login()">AUTHORIZE</button>
            <button onclick="enterAsStaff()" style="background:none; border:none; color:var(--text-dim); margin-top:30px; cursor:pointer; font-size: 0.7rem; letter-spacing: 2px;">STAFF ACCESS</button>
        </div>
    </div>

    <div id="app" style="display:none;" class="wrapper">
        <aside>
            <div class="logo">Core System</div>
            <div class="nav-link active" onclick="switchTab('home', this)"><i class="bi bi-layers"></i> Dashboard</div>
            <div class="nav-link" onclick="switchTab('inv', this)"><i class="bi bi-box-seam"></i> Inventory</div>
            <div class="nav-link" onclick="switchTab('parts', this)"><i class="bi bi-shield-check"></i> Partners</div>
            <div class="nav-link admin-only" id="nav-staff" onclick="switchTab('staff', this)"><i class="bi bi-person-badge"></i> Personnel</div>
            <div style="margin-top:auto" class="nav-link" onclick="location.reload()"><i class="bi bi-lock"></i> Terminate</div>
        </aside>

        <main>
            <div id="tab-home" class="tab-content active">
                <div class="header-row">
                    <h1 id="h_comp">ADMINISTRATION</h1>
                    <div style="margin-top: 20px; display: flex; gap: 15px;">
                        <button class="btn btn-outline" onclick="openModal('expenses')">+ Expense</button>
                        <button class="btn btn-primary" onclick="openModal('clients')">+ Transaction</button>
                    </div>
                </div>

                <div class="stat-grid admin-only" id="admin-stats">
                    <div class="card"><small id="lbl_rev">Revenue</small><span class="val" id="tot_rev">0</span></div>
                    <div class="card"><small>Operational Cost</small><span class="val" id="tot_exp" style="color: #666;">0</span></div>
                    <div class="card"><small>Net Profit</small><span class="val" id="tot_profit" style="color: var(--primary);">0</span></div>
                </div>

                <div class="table-wrap">
                    <table>
                        <thead>
                            <tr><th id="th_n">Entity</th><th id="th_d">Reference</th><th>Amount</th><th class="admin-only">Action</th></tr>
                        </thead>
                        <tbody id="list-body"></tbody>
                    </table>
                </div>
            </div>

            <div id="tab-inv" class="tab-content">
                <div class="header-row"><h1>STOCKS</h1><button class="btn btn-primary" onclick="openModal('inventory')">+ Add Item</button></div>
                <div class="table-wrap"><table><thead><tr><th>Resource</th><th>Quantity</th><th>Unit Price</th><th class="admin-only"></th></tr></thead><tbody id="inv-body"></tbody></table></div>
            </div>

            <div id="tab-parts" class="tab-content">
                <div class="header-row"><h1>PARTNERS</h1><button class="btn btn-primary" onclick="openModal('partners')">+ New Entity</button></div>
                <div class="table-wrap"><table><thead><tr><th>Entity Name</th><th>Contact</th><th>Type</th><th class="admin-only"></th></tr></thead><tbody id="parts-body"></tbody></table></div>
            </div>

            <div id="tab-staff" class="tab-content">
                <div class="header-row"><h1>PERSONNEL</h1><button class="btn btn-primary" onclick="openModal('employees')">+ New Member</button></div>
                <div class="table-wrap"><table><thead><tr><th>Name</th><th>Position</th><th>Compensation</th><th class="admin-only"></th></tr></thead><tbody id="staff-body"></tbody></table></div>
            </div>
        </main>
    </div>

    <div class="modal" id="modal">
        <div class="modal-content">
            <h2 id="m_title" style="font-weight: 200; letter-spacing: 3px; margin-bottom: 40px;">DATA ENTRY</h2>
            <div id="m_fields"></div>
            <button class="btn btn-primary" style="width: 100%;" onclick="save()">Execute</button>
            <button onclick="closeModal()" style="width:100%; background:none; border:none; color:var(--text-dim); margin-top:20px; cursor:pointer; font-size: 0.7rem; letter-spacing: 2px;">CANCEL</button>
        </div>
    </div>

    <script>
        let config = {}; let role = 'staff'; let activeType = '';

        async function init() {
            const res = await fetch('/api/config'); config = await res.json();
            document.getElementById('l_comp').innerText = config.companyName;
            document.getElementById('h_comp').innerText = config.companyName;

            const dict = {
                restaurant: { rev: "GASTRO REVENUE", list: "ORDERS", n: "TABLE", d: "ITEMS" },
                doctor: { rev: "CLINIC REVENUE", list: "PATIENTS", n: "PATIENT", d: "TREATMENT" },
                mechanic: { rev: "SERVICE REVENUE", list: "JOBS", n: "PLATE", d: "DIAGNOSIS" },
                general: { rev: "TOTAL REVENUE", list: "TRANSACTIONS", n: "ENTITY", d: "DETAILS" }
            };
            const t = dict[config.industry] || dict.general;
            document.getElementById('lbl_rev').innerText = t.rev;
            document.getElementById('th_n').innerText = t.n; document.getElementById('th_d').innerText = t.d;
        }

        async function login() {
            const res = await fetch('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({password: document.getElementById('pass').value})});
            if(res.ok) { role = 'admin'; unlock(); } else alert('AUTH FAILED');
        }

        function enterAsStaff() { role = 'staff'; unlock(); }

        function unlock() {
            document.getElementById('login-screen').style.display='none';
            document.getElementById('app').style.display='flex';
            if(role === 'admin') document.querySelectorAll('.admin-only').forEach(e => e.style.display = 'block');
            refresh();
        }

        async function refresh() {
            const get = t => fetch('/api/'+t).then(r => r.json());
            const [c, i, p, e, ex] = await Promise.all([get('clients'), get('inventory'), get('partners'), get('employees'), get('expenses')]);
            
            if(role === 'admin') {
                const totalRev = c.reduce((s,x)=>s+x.amount,0);
                const totalExp = ex.reduce((s,x)=>s+x.amount,0);
                const totalSal = e.reduce((s,x)=>s+(x.salary||0),0);
                document.getElementById('tot_rev').innerText = totalRev.toLocaleString() + ' ' + config.currency;
                document.getElementById('tot_exp').innerText = (totalExp + totalSal).toLocaleString() + ' ' + config.currency;
                document.getElementById('tot_profit').innerText = (totalRev - totalExp - totalSal).toLocaleString() + ' ' + config.currency;
            }

            const delBtn = (t,id) => role === 'admin' ? `<i class="bi bi-trash" onclick="delItem('${t}','${id}')" style="color:#333; cursor:pointer;"></i>` : '';
            
            document.getElementById('list-body').innerHTML = c.map(x => `<tr><td>${x.name}</td><td>${x.details}</td><td>${x.amount.toLocaleString()}</td><td class="admin-only">${delBtn('clients',x._id)}</td></tr>`).join('');
            document.getElementById('inv-body').innerHTML = i.map(x => `<tr><td>${x.name}</td><td>${x.qty}</td><td>${x.price.toLocaleString()}</td><td class="admin-only">${delBtn('inventory',x._id)}</td></tr>`).join('');
            document.getElementById('parts-body').innerHTML = p.map(x => `<tr><td>${x.name}</td><td>${x.contact}</td><td>${x.type}</td><td class="admin-only">${delBtn('partners',x._id)}</td></tr>`).join('');
            document.getElementById('staff-body').innerHTML = e.map(x => `<tr><td>${x.name}</td><td>${x.role}</td><td>${(x.salary||0).toLocaleString()}</td><td class="admin-only">${delBtn('employees',x._id)}</td></tr>`).join('');
        }

        function openModal(type) {
            activeType = type;
            let h = `<input id="i1" placeholder="NAME / ID"><input id="i2" placeholder="DESCRIPTION"><input id="i3" type="number" placeholder="VALUE">`;
            if(type === 'employees') h = `<input id="i1" placeholder="MEMBER NAME"><input id="i2" placeholder="POSITION"><input id="i3" type="number" placeholder="SALARY">`;
            if(type === 'expenses') h = `<input id="i1" placeholder="EXPENSE TITLE"><input id="i3" type="number" placeholder="AMOUNT">`;
            document.getElementById('m_fields').innerHTML = h;
            document.getElementById('modal').style.display = 'flex';
        }

        async function save() {
            const data = { 
                name: val('i1'), details: val('i2'), amount: Number(val('i3')||0), 
                qty: Number(val('i2')||0), price: Number(val('i3')||0), 
                contact: val('i2'), type: val('i3'), role: val('i2'), salary: Number(val('i3')||0)
            };
            await fetch('/api/'+activeType, { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(data)});
            closeModal(); refresh();
        }

        async function delItem(type, id) {
            if(confirm('TERMINATE DATA?')) { await fetch(`/api/${type}/${id}`, { method: 'DELETE' }); refresh(); }
        }

        function switchTab(t, b) {
            document.querySelectorAll('.tab-content, .nav-link').forEach(x => x.classList.remove('active'));
            document.getElementById('tab-'+t).classList.add('active'); b.classList.add('active');
        }

        const val = id => document.getElementById(id).value;
        const closeModal = () => document.getElementById('modal').style.display = 'none';
        init();
    </script>
</body>
</html>